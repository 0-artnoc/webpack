// Chunked File Libary
window.test(window.writing, "Lib2 Should be in first tick");
var asnycOk = false, asnycOk2 = false;
require.ensure("./extra", function(require) {
	asnycOk = true;
	window.test(!window.writing, "Lib2 Should be asynchron loaded");
	var sameTick = true;
	require.ensure([], function(require) {
		asnycOk2 = true;
		window.test(require("./extra") === "Lib2 extra2 with post loader", "Lib2 extra loaded");
		window.test(sameTick, "Lib2 Should be in the same tick, as it is a empty chunk");
		require.ensure(["./test.js"], function(require) {
			window.test(require("./test.js") === "test module", "Lib2 recursive require.ensure");
			window.test(sameTick, "Lib2 Should be in the same tick, as it should be merged into one chunk");
		});
	});
	sameTick = false;
});
setTimeout(function() {
	window.test(asnycOk, "Lib2 Chunk 1 should be loaded");
	window.test(asnycOk2, "Lib2 Chunk 2 should be loaded");
}, 3000);
window.test(!asnycOk, "Lib2 Chunk 1 should not be loaded yet");
window.test(!asnycOk2, "Lib2 Chunk 2 should not be loaded yet");
exports.ok = true;

var emptyRequire = false;
require([], function() {
	emptyRequire = true;
	window.test(require.amd.fromOptions, "Lib2 require.amd should come from options");
});
window.test(emptyRequire, "Lib2 empty AMD require should work");
